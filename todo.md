# 토론회/강연회 신청 시스템 TODO

## 데이터베이스 스키마
- [x] 사용 가능한 시간대 테이블 (availableSlots)
- [x] 모임 테이블 (events) - 확정된 모임과 제안 구분
- [x] 참여자 정보 테이블 (participants)
- [x] 모임 참여 신청 테이블 (registrations)

## 백엔드 API (tRPC)
- [x] 관리자: 사용 가능한 시간대 설정 API
- [x] 관리자: 모임 승인/거부 API
- [x] 관리자: 모임 리스트 조회 API
- [x] 관리자: 각 모임별 신청자 리스트 조회 API
- [x] 주관자: 모임 제안 생성 API
- [x] 주관자: 모임 수정/삭제 API
- [x] 참여자: 모임 리스트 조회 API (승인된 모임만)
- [x] 참여자: 모임 신청 API
- [x] 참여자: 내 신청 내역 조회 API

## 프론트엔드 UI
- [x] 메인 화면 (참여자용) - 모임 리스트 + 달력
- [x] 참여자 정보 입력 폼 (localStorage 저장)
- [x] 모임 상세 정보 표시
- [x] 관리자 대시보드 - 시간대 설정
- [x] 관리자 대시보드 - 모임 승인 관리
- [x] 관리자 대시보드 - 신청자 리스트
- [x] 주관자 페이지 - 모임 제안/생성
- [x] 주관자 페이지- 내 모임 관리
- [x] UI 스타일 적용 (참조 가이드 기반)

## 테스트
- [x] 관리자 기능 vitest 테스트
- [x] 주관자 기능 vitest 테스트
- [x] 참여자 기능 vitest 테스트
- [x] 브라우저 통합 테스트

## 새로운 기능 추가
- [x] 달력 뷰 컴포넌트 구현
- [x] 달력에 모임 일정 표시
- [x] 달력에서 날짜 클릭 시 해당 날짜 모임 필터링
- [x] 이메일 알림 API 구현
- [x] 모임 승인 시 주관자에게 이메일 발송
- [x] 모임 신청 완료 시 참여자에게 이메일 발송
- [x] 이메일 알림 기능 테스트

## UI/UX 개선 및 자동 확정 시스템
- [x] 메인 화면 레이아웃 변경 (모임 리스트 상단, 달력 하단)
- [x] 달력 Collapsible 컴포넌트로 변경 (기본 접힘)
- [x] 브랜딩 변경: "SPARK (Sharing Perspectives and Remarkable Knowledge)"
- [x] events 테이블에 minParticipants 필드 추가
- [x] 모임 생성 시 최소 참여 인원 입력 필드 추가
- [x] 신청 시 최소 인원 달성 여부 체크 로직
- [x] 최소 인원 달성 시 자동 확정 및 이메일 발송
- [x] 확정 이메일 발송 (참여자 + 주관자)
- [x] 자동 확정 기능 테스트

## 확정모임 vs 미정모임 구분
- [x] 확정모임과 미정모임 테두리 스타일 차별화
- [x] 확정모임 생성 시 일정 필수 검증
- [x] 미정모임 일정 선택사항으로 변경
- [x] 두 모임 모두 참여 신청 가능하도록 유지
- [x] OrganizerPage에서 모임 타입별 안내 추가

## 회원가입 시스템 구축
- [x] users 테이블에 전화번호, 계좌번호 필드 추가
- [x] 회원가입 API 구현 (이름, 이메일, 전화번호, 암호, 계좌번호)
- [x] 로그인 API 구현 (이메일, 암호)
- [x] 회원가입 페이지 UI 구현
- [x] 로그인 페이지 UI 구현
- [x] 모임 개설은 로그인한 회원만 가능하도록 제한
- [x] 참여자 신청은 기존 방식 유지 (회원가입 불필요)
- [x] 메인 화면 헤더에 "모임 개설" 버튼 추가
- [x] 로그인한 회원에게만 "모임 개설" 버튼 표시
- [x] 슈퍼 어드민 계정 생성 (loginheaven@gmail.com)
- [x] 주관자는 자신이 만든 모임만 수정/삭제 가능
- [x] 슈퍼 어드민은 모든 모임 수정/삭제 가능
- [x] 로그인/회원가입 모달 구현
- [x] 모임 개설 버튼 클릭 시 로그인 상태 확인 로직
- [x] 회원가입 시스템 테스트

## OAuth 제거 및 어드민 로그인 문제 해결
- [x] OAuth(구글 로그인) 완전 제거
- [x] 로컬 로그인만 사용하도록 변경
- [x] 어드민 로그인 문제 확인 및 수정
- [x] 메인 화면에서 직접 로그인 가능하도록 UI 개선
- [x] 테스트 및 검증

## 로그인 실패 문제 해결
- [x] "Invalid login method" 에러 원인 확인
- [x] 로그인 로직 수정
- [x] 테스트 및 검증

## 로그인 체계 정리
- [x] 현재 로그인 흐름 확인 (구글 로그인 잔여 코드 확인)
- [x] AuthModal에서 구글 로그인 버튼 제거
- [x] const.ts에서 OAuth 관련 코드 제거
- [x] 로그인 흐름 명확화: 모임 개설 클릭 → 로그인 모달 → 회원가입/로그인
- [x] 로그인 후 역할 확인 (슈퍼 어드민 vs 일반 회원)
- [x] 테스트 및 검증

## 로그인 리다이렉트 문제 해결
- [x] 회원가입 후 로그인 시 구글 로그인으로 리다이렉트되는 문제 확인
- [x] AuthModal 로그인 성공 후 페이지 새로고침 로직 확인
- [x] 로그인 쿠키 설정 확인
- [x] 문제 수정 및 테스트

## 로그인 상태 반영 문제 해결
- [x] localAuth.me API 확인
- [x] 쿠키 설정 및 읽기 로직 확인
- [x] context.ts에서 local_user_id 쿠키 처리 확인
- [x] 로그인 후 상태 반영 로직 수정
- [x] 테스트 및 검증

## 로그인 쿠키 설정되지만 상태 반영 안 되는 문제
- [ ] local_user_id 쿠키가 설정되는지 확인 (완료: 150002로 설정됨)
- [x] sdk.ts authenticateRequest 함수에 디버깅 로그 추가
- [ ] localAuth.me API 응답 확인
- [x] 배포 반영 확인 (서버 재시작)
- [ ] 프론트엔드 빌드 재생성
- [ ] 테스트 및 검증

## 참여자 정보 저장 상태에서 정식 로그인 문제
- [x] 문제 확인: localStorage에 참여자 정보가 있을 때 정식 로그인 후 다시 참여자 상태로 돌아감
- [x] 원인 파악: 로그인 후 페이지 새로고침 시 useEffect가 localStorage 참여자 정보를 다시 불러옴
- [x] 해결: AuthModal 로그인 성공 시 localStorage 참여자 정보 삭제
- [x] 테스트 및 검증

## 쿠키 sameSite 설정 문제 해결
- [x] 문제 확인: 로그인 성공 후 쿠키가 브라우저에 저장되지 않음
- [x] 원인 파악: sameSite: "none"으로 설정되어 same-site 요청에서 쿠키가 전송되지 않음
- [x] 해결: sameSite를 "lax"로 변경하여 same-site 요청에서 쿠키 전송 허용
- [x] 테스트 수정 및 검증

## 로그인 후 UI 반영 안 되는 문제 (긴급)
- [x] 문제 확인: 로그인 성공 후에도 사용자 이름이 표시되지 않고 모임 개설 버튼 클릭 시 다시 로그인 창이 뜨
- [x] 로그인 API 응답 확인 (쿠키가 실제로 설정되는지)
- [x] 쿠키가 브라우저에 저장되는지 확인
- [x] 쿠키가 후속 요청에 전송되는지 확인
- [x] localAuth.me API가 쿠키를 읽어 사용자 정보를 반환하는지 확인
- [x] 프론트엔드에서 localUser 상태가 업데이트되는지 확인
- [x] 문제 수정: Express 서버에 cookie-parser 미들웨어 추가
- [x] 테스트 및 검증

## 로그인 프로세스 재정비 및 기능 개선
- [x] 로그인 시스템 통합: 모임 참여와 모임 개설 모두 동일한 로그인 화면 사용
- [x] 참여자 정보 입력 제거: localStorage 기반 참여자 정보 시스템 제거
- [x] 회원가입 필수 필드 변경: 이름, 이메일, 전화번호, 비밀번호 필수 (계좌번호 선택)
- [x] 계좌번호 필드에 "모임개설자만 필요" 안내 문구 추가
- [x] 헤더에 로그인/로그아웃 버튼 항상 표시
- [x] 모임현황 페이지 구현: 내가 신청한 모임 + 내가 개설한 모임 목록
- [x] 슬퍼 어드민 계정 설정: loginheaven@gmail.com / 1234qwer
- [x] 슬퍼 어드민 기능: 모임 리스트에서 모든 모임 수정/삭제 가능
- [x] 일반 주관자: 자신이 개설한 모임만 수정/삭제 가능
- [x] 테스트 및 검증

## 모임 개설 시스템 개선
- [x] DB 스키마 수정: maxParticipants 필드 추가
- [x] 유료/무료 선택 UI 추가 (토글 방식)
- [x] 유료 선택 시 계좌번호 필수 입력 로직
- [x] 계좌번호 미입력 시 회원정보에서 불러오기 또는 입력 요청
- [x] localAuth.me API에 accountNumber 필드 추가
- [x] updateProfile API 추가로 계좌번호 수정 가능
- [x] 최소 인원, 최대 인원 입력 필드 추가
- [x] "본인도 참여" 체크박스 추가 (기본 체크됨)
- [x] 체크 시 개설자를 registrations 테이블에 자동 등록
- [x] participants 테이블에 userId 필드 추가
- [x] 모임 카드에 현재 참여 인원 / 최소 인원 표시 (예: 2/10)
- [x] 최소 인원 도달 시 확정 아이콘 명확히 표시 (기존 기능 유지)
- [x] 참여 인원 수 계산 로직 최적화 (개설자 포함 여부 반영)
- [x] 테스트 통과

## 시간대 선택 기능 단순화
- [x] users 테이블에 alwaysAvailable 필드 추가 (기본값 true)
- [x] 사용 가능한 시간대 화면에 "항상 가능" 체크박스 추가 (기본 체크됨)
- [x] "항상 가능" 체크 시 모임 개설 화면에서 "가능한 시간대: 항상 가능" 메시지 표시
- [x] "항상 가능" 체크 해제 시 기존 시간대 선택 UI 활성화 (추후 완성 예정)
- [x] localAuth.me API에 alwaysAvailable 필드 추가
- [x] updateProfile API에 alwaysAvailable 필드 추가
- [x] 테스트 통과

## 시스템 분석 결과 - 발견된 문제 수정
- [x] Home.tsx 수정/삭제 버튼 권한 수정 (개설자 + 어드민)
- [x] Home.tsx 모임 카드에 큰 "참여" 아이콘 추가 (UserPlus 아이콘)
- [x] 이미 참여한 모임은 "참여완료" 아이콘으로 변경 (UserCheck 아이콘)
- [x] "참여완료" 클릭 시 참여 취소 확인 팝업 및 처리
- [x] localStorage를 로그인 정보 자동 완성용으로 변경
- [x] localStorage 기반 참여자 정보 시스템 완전 제거
- [x] participants.register API를 userId 기반으로 수정
- [x] participants.myRegistrations API를 userId 기반으로 수정
- [x] DB 함수들을 userId로 조회하도록 수정 (getRegistrationsByUserId, deleteRegistrationByUserIdAndEventId)
- [x] participants.unregister API 추가
- [x] Home.tsx 완전 재작성 (모든 문제 해결)
- [x] 테스트 통과 (18/18)

## 새로운 요구사항 (2025-01-09)
- [x] 우측 상단 사용자 메뉴 드롭다운 구현 (로그인 버튼 → 이름 표시 → 정보수정/로그아웃)
- [x] 정보수정 페이지 구현 (이름, 전화번호, 계좌번호 수정)
- [x] 필수정보 입력 강제 (이름 없는 사용자 자동 리다이렉트)
- [x] 모임 상세 페이지 구현 (참여자 목록, 주관자 정보, 상세 설명)
- [x] 최대 인원 체크 제거 검증 (최대 인원은 권장 인원, 마감 없음)
- [x] 회원가입 시 개인정보 제공 동의 체크박스 추가 (필수)

## 새로운 요구사항 (2025-01-09 #2)
- [x] 모임 개설 시 키워드 입력칸 추가 (쉼표로 구분)
- [x] 모임 개설 시 강사 이름 입력칸 추가 (개설자와 강사가 다를 수 있음)
- [x] 데이터베이스 스키마에 instructorName 필드 추가
- [x] 모임 카드에 강사 이름 표시
- [x] 초기화면 중앙에 검색창 추가
- [x] 검색 기능: 강사 이름, 제목/설명, 키워드로 필터링

## 새로운 요구사항 (2025-01-09 #3)
- [x] 계좌번호 입력칸 보조설명 수정 ("선택" → "유료 모임을 개설할 경우 필요합니다")
- [x] 공통 헤더 컴포넌트 생성 (로그인 버튼/사용자 이름 표시)
- [x] 모든 페이지에 공통 헤더 적용 (OrganizerPage, MyEvents, ProfilePage, EventDetailPage 등)
- [x] 모임 개설 팝업 입력 내용 localStorage에 자동 저장
- [x] 팝업 다시 열 때 이전 입력 내용 복원
- [x] EventDetailPage 에러 수정
- [x] 확정모임/미정모임 탭 제거, 한 화면에 모두 표시
- [x] 미정모임 카드는 점선 테두리로 구분

## 긴급 수정 (2025-01-09 #4)
- [x] Home.tsx에 공통 헤더 적용 (로그인 버튼이 우측 상단 동일한 위치에 표시되도록)
- [x] ProfilePage 계좌번호 "(선택)" 문구를 "유료 모임을 개설할 경우 필요합니다"로 수정

## 새로운 요구사항 (2025-01-09 #5)
- [x] 모임 카드에 참여자 수/최대 인원 진행률 바(progress bar) 추가
- [x] 진행률에 따라 색상 구분 (여유/보통/마감임박)

## 새로운 요구사항 (2025-01-09 #6)
- [x] 진행률 바 기준을 최대 인원에서 최소 인원으로 변경
- [x] 최소 인원 도달 시 자동 이메일 알림 발송 (기존에 구현됨)
- [x] 비밀번호 재설정 데이터베이스 스키마 추가 (password_reset_tokens 테이블)
- [x] 비밀번호 찾기 API 구현 (이메일로 재설정 링크 발송)
- [x] 비밀번호 재설정 API 구현 (토큰 검증 및 비밀번호 변경)
- [x] 비밀번호 변경 API 구현 (로그인 상태에서 변경)
- [x] 비밀번호 찾기 프론트엔드 페이지 구현
- [x] 비밀번호 재설정 프론트엔드 페이지 구현
- [x] AuthModal에 "비밀번호 찾기" 링크 추가

## 긴급 수정 (2025-01-09 #7)
- [x] Header 버튼 순서 변경 (모임개설 왼쪽, 로그인 오른쪽)
- [x] 로그인 버튼 클릭 문제 해결 (AuthModal 열도록 수정)
- [x] 로그인 후 이름 드롭다운 UI 개선 (ChevronDown 아이콘 추가, hover 효과)

## 긴급 수정 (2025-01-09 #8)
- [x] 모임수정 팝업(Dialog)에 스크롤 기능 추가 (max-h-[90vh] overflow-y-auto)
- [x] 참여 신청 시 이름 필수 체크 강화 (서버 API에 체크 추가)
- [x] EventDetailPage에서도 필수정보 체크 추가 (기존에 구현됨)

## 새로운 요구사항 (2025-01-09 #9)
- [x] 참여자 목록 역할별 표시: 일반 사용자는 이름만, 관리자는 이름/연락처/이메일/신청일시 모두 표시

## 긴급 수정 (2025-01-09 #11)
- [x] 관리자 메뉴가 드롭다운에 표시되지 않는 문제 해결
- [x] 홈 화면에 다른 회원이 개설한 모임이 표시되지 않는 문제 해결

## 새로운 요구사항 (2025-01-09 #12)
- [x] 데이터베이스 스키마에 status 필드 추가 (proposal/scheduled/confirmed) - `eventStatus`로 구현
- [x] 모임 개설 폼에 무료/유료 라디오 버튼 추가 (스위치로 구현됨)
- [x] 모임 개설 폼에 모임 단계 선택 추가 (제안/개설확정/진행확정)
- [x] 모임 카드 테두리 구분 (제안: 점선+회색, 개설확정: 실선+파란색, 진행확정: 굵은실선+초록색)
- [x] 모임 카드에 단계 배지 추가
- [x] 최소 인원 도달 시 scheduled → confirmed 자동 전환
